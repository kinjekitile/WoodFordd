@model ReservationViewModel
@{
    ViewBag.Title = "Confirm Changes";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="six columns">
        <h1>Cancel Reservation</h1>
    </div>
</div>


<div class="row">
    <div class="six columns">
        <div class="reservation-number">
            <h2>Reservation Number: <span>@Model.Reservation.Id</span></h2>
        </div>

    </div>
</div>
<div class="row">



    <div class="six columns">

        <h2>Current Details</h2>

        <h3>Vehicle</h3>
        @if (Model.Reservation.VehicleUpgrade != null) {
            <p><strong>@Model.Reservation.VehicleUpgrade.Title</strong></p>
            <p>Upgraded from @Model.Reservation.Vehicle.Title</p>

        }
        else {
            <p><strong>@Model.Reservation.Vehicle.Title</strong></p>
            }

        <h2>Hire Dates</h2>
        <p>
            Pick Up <strong style="margin: 0 10px;">@Model.Reservation.PickupDate.ToString("dd MMMM yyyy h:mm tt")</strong> @Model.Reservation.PickupBranch.Title
            <br />
            Drop Off <strong style="margin: 0 10px;">@Model.Reservation.DropOffDate.ToString("dd MMMM yyyy h:mm tt")</strong> @Model.Reservation.DropOffBranch.Title
        </p>

        <h3>@Model.Reservation.RateCodeTitle</h3>

        <h4>Cost Summary</h4>
        <table class="cost-summary">
            <tr>
                <th scope="row">Rental</th>
                <td>@String.Format("{0:c}", Model.Reservation.AdjustedPrice)</td>
            </tr>
            <tr>
                <th scope="row">Tax</th>
                <td>@String.Format("{0:c}", Model.Reservation.TaxAmount)</td>
            </tr>
            <tr>
                <th scope="row"><strong>Total</strong></th>
                <td><strong>@String.Format("{0:c}", Model.Reservation.AdjustedPrice + Model.Reservation.TaxAmount)</strong></td>
            </tr>
            @if (Model.Reservation.DropOffFee > 0) {
                <tr>
                    <th scope="row">Drop Off Fee</th>
                    <td>@String.Format("{0:c}", Model.Reservation.DropOffFee)</td>
                </tr>
            }
            <tr>
                <th scope="row">Admin Fee</th>
                <td>@String.Format("{0:c}", Model.Reservation.ContractFee)</td>
            </tr>

            @foreach (var x in Model.Reservation.VehicleExtras) {
                <tr>
                    <th scope="row">@x.ExtraTitle</th>
                    @if (x.ReservationLoyaltyBenefitId.HasValue) {
                        <td>Advance - Free</td>
                    } else {

                        <td>@String.Format("{0:c}", x.ExtraPrice * Model.Reservation.NumberOfDays)</td>
                    }

                </tr>
            }
            @if (Model.Reservation.VehicleUpgradeId != null) {
                <tr>
                    <th scope="row">Upgrade to @Model.Reservation.VehicleUpgrade.Title</th>
                    @if (Model.Reservation.Benefits.Select(x => x.UpgradeId).Contains(Model.Reservation.VehicleUpgradeId)) {
                        <td>Advance - Free</td>
                    } else {
                        <td>@String.Format("{0:c}", Model.Reservation.VehicleUpgradePriceAmount)</td>
                    }

                </tr>
            }

            <tr class="total total-row">
                <th scope="row"><strong>Final</strong></th>
                <td id="total-price">
                    @String.Format("{0:c}", Model.Reservation.BookingPrice)
                </td>
            </tr>
            <tr class="total-days">
                <td></td>
                <td class="numeric-field">For @Model.Reservation.NumberOfDays.ToString() Days</td>
            </tr>

            <tr>
                <th scope="row">Paid Upon Booking</th>
                <td style="text-align: right;">R @Model.Reservation.Invoice.AmountPaid.ToString("#,##0.00")</td>
            </tr>

            @if (Model.Reservation.BookingPrice - Model.Reservation.Invoice.AmountPaid > 0.01m) {
                <tr>
                    <th scope="row">To be Paid Upon Collection</th>
                    <td style="text-align: right;">R @((Model.Reservation.BookingPrice - Model.Reservation.Invoice.AmountPaid).ToString("#,##0.00"))</td>
                </tr>
            }

        </table>




    </div>

    <div class="six columns">

        @if (Model.Reservation.Invoice.AmountPaid > 0) {
            if (Model.Reservation.Invoice.AmountPaid > 250) {

                <p>Please note that if you choose to cancel a booking more than 24 hours before the time of collection, an administration fee of R250 will be charged.
</p>
                <p>You will be refunded R @Model.Reservation.Invoice.AmountPaid.ToString("#,##0.00") less R250 cancellation fee.</p>
            }
            else {
                <p>
                    Please note that if you choose to cancel a booking more than 24 hours before the time of collection, an administration fee of R250 will be charged.
                </p>

                <p>As your booking fee is less than the cancellation fee the amount already paid will be forfitted.</p>
            }
        }
        
        <p>Please confirm your cancellation</p>

        @using (Html.BeginForm()) {
            @Html.HiddenFor(x => x.Reservation.Id)
            @Html.HiddenFor(x => x.Reservation.QuoteReference)
            @Html.ValidationSummary()
            <input type="submit" value="Confirm Cancel Reservation" />
        }

    </div>


</div>
