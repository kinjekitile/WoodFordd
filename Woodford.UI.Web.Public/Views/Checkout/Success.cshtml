@model CheckoutSuccessViewModel
@{
    ViewBag.Title = "Success";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<div class="row">
    <div class="twelve columns">
        <h1>Success</h1>
    </div>
</div>

<div class="row">
    <div class="eight columns">

        <div class="reservation-number">
            Reservation Number: <span>@Model.Reservation.Id</span>
        </div>

        <p class="thank-you-message">Thank you for choosing Woodford Car Hire. We look forward to meeting you.</p>

        <p><a class="printquote" href="#">Print</a></p>
        <h2>Booking Details</h2>

        @if (Model.Reservation.UserId == null) {
            if (!string.IsNullOrEmpty(Model.Reservation.FirstName) || (!string.IsNullOrEmpty(Model.Reservation.LastName))) {
                <text>Full Name: </text><strong>@Model.Reservation.FirstName @Model.Reservation.LastName</strong><br />
            }
            <text> Email: </text> <strong>@Model.Reservation.Email</strong><br />
            if (!string.IsNullOrEmpty(Model.Reservation.MobileNumber)) {
                <text>Cell: </text><strong>@Model.Reservation.MobileNumber</strong><br />
            }
            if (!string.IsNullOrEmpty(Model.Reservation.IdNumber)) {
                <text>ID No: </text><strong>@Model.Reservation.IdNumber</strong>
            }
        } else {
            if (!string.IsNullOrEmpty(Model.Reservation.User.FirstName) || (!string.IsNullOrEmpty(Model.Reservation.User.LastName))) {
                <text>Full Name: </text><strong>@Model.Reservation.FirstName @Model.Reservation.LastName</strong><br />
            }
            <text> Email: </text> <strong>@Model.Reservation.User.Email</strong><br />
            if (!string.IsNullOrEmpty(Model.Reservation.User.MobileNumber)) {
                <text>Cell: </text><strong>@Model.Reservation.User.MobileNumber</strong><br />
            }
            if (!string.IsNullOrEmpty(Model.Reservation.User.IdNumber)) {
                <text>ID No: </text><strong>@Model.Reservation.User.IdNumber</strong>
            }
        }

        <h3>Vehicle</h3>
        @if (Model.UpgradeToVehicle != null) {
            <p><strong>@Model.UpgradeToVehicle.Title</strong></p>
            <p>Upgraded from @Model.Vehicle.Title</p>

        } else {
            <p><strong>@Model.Vehicle.Title</strong></p>
        }

        <h2>Hire Dates</h2>
        <p>
            Pick Up <strong style="margin: 0 10px;">@Model.Reservation.PickupDate.ToString("dd MMMM yyyy h:mm tt")</strong> @Model.Reservation.PickupBranch.Title
            <br />
            Drop Off <strong style="margin: 0 10px;">@Model.Reservation.DropOffDate.ToString("dd MMMM yyyy h:mm tt")</strong> @Model.Reservation.DropOffBranch.Title
        </p>

        <h3>@Model.Reservation.RateCodeTitle</h3>

        <h4>Cost Summary</h4>
        <table class="cost-summary">
            <tr>
                <th scope="row">Rental</th>
                <td>@String.Format("{0:c}", Model.Reservation.AdjustedPrice)</td>
            </tr>
            @if (Model.Reservation.VoucherId.HasValue) {
                <tr>
                    <th scope="row">Voucher</th>

                    @switch (Model.Reservation.VoucherRewardType) {
                        default:
                            <td>
                                @(String.Format("{0:c}", -1 * Model.Reservation.VoucherDiscountAmount))
                            </td>
                            break;
                        case VoucherRewardType.TextReward:
                            <td>
                                @(Model.Reservation.VoucherRewardText)
                            </td>
                            break;
                    }

                </tr>
            }
            <tr>
                <th scope="row">Tax</th>
                <td>@String.Format("{0:c}", Model.Reservation.TaxAmount)</td>
            </tr>
            <tr>
                <th scope="row"><strong>Total</strong></th>
                <td><strong>@String.Format("{0:c}", Model.Reservation.AdjustedPrice - Model.Reservation.VoucherDiscountAmount + Model.Reservation.TaxAmount)</strong></td>
            </tr>
            @if (Model.Reservation.DropOffFee > 0) {
                <tr>
                    <th scope="row">Drop Off Fee</th>
                    <td>@String.Format("{0:c}", Model.Reservation.DropOffFee)</td>
                </tr>
            }
            <tr>
                <th scope="row">Admin Fee</th>
                <td>@String.Format("{0:c}", Model.Reservation.ContractFee)</td>
            </tr>
            @if (Model.Reservation.LoyaltyPointsSpent.HasValue) {
                <tr>
                    <th scope="row" style="border-top: 1px solid #ccc;color:#187546;">Advance Points Used</th>
                    <td style="border-top: 1px solid #ccc;">@decimal.Round(Model.Reservation.LoyaltyPointsSpent.Value, 2)</td>
                </tr>
            }
            @foreach (var surcharge in Model.Reservation.BranchSurcharges) {

                if (surcharge.IsOnceOff) {
                    <tr>
                        <th scope="row">@surcharge.Title</th>
                        <td>@String.Format("{0:c}", surcharge.SurchargePrice)</td>
                    </tr>
                } else {
                    <tr>
                        <th scope="row">@surcharge.Title (@String.Format("{0:c}", surcharge.SurchargePrice) per day)</th>
                        <td>@String.Format("{0:c}", surcharge.SurchargePrice * Model.Reservation.NumberOfDays)</td>
                    </tr>
                }

            }
            @foreach (var x in Model.Reservation.VehicleExtras) {
                <tr>
                    <th scope="row">@x.ExtraTitle</th>
                    @if (x.ReservationLoyaltyBenefitId.HasValue) {
                        <td>Advance - Free</td>
                    } else {

                        <td>@String.Format("{0:c}", x.ExtraPrice * Model.Reservation.NumberOfDays)</td>
                    }

                </tr>
            }
            @if (Model.Reservation.VehicleUpgradeId != null) {
                <tr>
                    <th scope="row">Upgrade to @Model.UpgradeToVehicle.Title</th>
                    @if (Model.Reservation.Benefits.Select(x => x.UpgradeId).Contains(Model.Reservation.VehicleUpgradeId)) {
                        <td>Advance - Free</td>
                    } else {
                        <td>@String.Format("{0:c}", Model.Reservation.VehicleUpgradePriceAmount)</td>
                    }

                </tr>
            }

            @if (Model.Reservation.CountdownSpecialId.HasValue) {
                if (Model.Reservation.CountdownSpecialType.HasValue) {
                    if (Model.Reservation.CountdownSpecialType.Value == Woodford.Core.DomainModel.Enums.CountdownSpecialType.TextOnInvoice) {
                        <tr>
                            <th scope="row">Countdown Special</th>
                            <td>@Model.Reservation.CountdownSpecialOfferText</td>
                        </tr>
                    }
                    if (Model.Reservation.CountdownSpecialType.Value == Woodford.Core.DomainModel.Enums.CountdownSpecialType.VehicleUpgrade) {
                        <tr>
                            <th scope="row">Countdown Special Upgrade</th>
                            <td>@Model.Reservation.CountdownSpecialOfferText</td>
                        </tr>
                    }
                }
            }

            <tr class="total total-row">
                <th scope="row"><strong>Final Payment</strong></th>
                <td id="total-price">
                    @String.Format("{0:c}", Model.Reservation.BookingPrice)
                </td>
            </tr>
            <tr class="total-days">
                <td></td>
                <td class="numeric-field">For @Model.Reservation.NumberOfDays.ToString() Days</td>
            </tr>

            <tr>
                <th scope="row">Paid Upon Booking</th>
                <td style="text-align: right;">R @Model.Invoice.AmountPaid.ToString("#,##0.00")</td>
            </tr>

            @if (Model.Reservation.BookingPrice - Model.Invoice.AmountPaid > 0.01m) {
                <tr>
                    <th scope="row">
                    @if (Model.Reservation.CorporateId.HasValue) {
                        <text>Payment Due</text>
                    }
                    else {
                        <text>To be Paid Upon Collection</text>
                    }
                    
                    </th>
                    <td style="text-align: right;">R @((Model.Reservation.BookingPrice - Model.Invoice.AmountPaid).ToString("#,##0.00"))</td>
                </tr>
            }

        </table>
        @if (Model.Reservation.CorporateId.HasValue) {
            if (Model.Reservation.VehicleUpgradeId != null) {

                <p>
                    The insurance excess on this vehicle is R @Model.Reservation.VehicleUpgrade.ExcessAmount.ToString("#,##0.00").<br />

                    

                </p>
            }
            else {
                <p>
                    The insurance excess on this vehicle is R @Model.Reservation.Vehicle.ExcessAmount.ToString("#,##0.00").<br />

                  

                </p>
            }
        }
        else {
            <h4>Authorisation Upon Collection</h4>
            if (Model.Reservation.VehicleUpgradeId != null) {

                <p>
                    The insurance excess on this vehicle is R @Model.Reservation.VehicleUpgrade.ExcessAmount.ToString("#,##0.00").<br />

                    Upon collection you would be required to pay a credit card deposit of R @Model.Reservation.VehicleUpgrade.DepositAmount.ToString("#,##0.00") for the duration. Upon return of the vehicle in the same condition the deposit will be refunded.

                </p>
            }
            else {
                <p>
                    The insurance excess on this vehicle is R @Model.Reservation.Vehicle.ExcessAmount.ToString("#,##0.00").<br />

                    Upon collection you would be required to pay a credit card deposit of R @Model.Reservation.Vehicle.DepositAmount.ToString("#,##0.00") for the duration. Upon return of the vehicle in the same condition the deposit will be refunded.

                </p>
            }
            <p style="margin: 10px 0;">If you would like peace of mind, we offer top up waivers, super waivers and tire & glass cover. Please enquire at the rental counter.</p>

            if (Model.Waivers.Count > 0) {
                <table class="waivers-list">
                    <thead>
                        <tr>
                            <th style="width: auto;" scope="col"></th>
                            <th class="numeric-field" style="width: auto;" scope="col">Cost per day</th>
                            <th class="numeric-field" style="width: auto;" scope="col">Max Liability</th>
                        </tr>
                    </thead>
                    <tbody>

                        @foreach (WaiverModel w in Model.Waivers) {
                            <tr>
                                <th scope="row">@w.WaiverType.ToString().Replace("_", " ")</th>
                                <td class="numeric-field">
                                    @if (w.CostPerDay.HasValue) {
                                        <text>R @w.CostPerDay.Value.ToString("#,##0.##")</text>
                                    }
                                    else {
                                        <text>n/a</text>
                                    }
                                </td>
                                <td class="numeric-field">
                                    @if (w.Liability.HasValue) {
                                        <text>R @w.Liability.Value.ToString("#,##0.##")</text>
                                    }
                                    else {
                                        <text>n/a</text>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        }
        

        <div class="print-message">
            This confirmation has been emailed to @Model.Reservation.Email
            <br />
            <a href="#" class="printquote">Print this Document</a>
        </div>

    </div>



    <div class="four columns">

        @if (Model.UpgradeToVehicle != null) {
            <h2>@Model.UpgradeToVehicle.Title</h2>
            <p>@Model.UpgradeToVehicle.VehicleGroup.TitleDescription</p>
            if (Model.UpgradeToVehicle.FileUploadId.HasValue) {
                <img src="@Url.Action("Index", "Uploads", new { id = Model.UpgradeToVehicle.VehicleImage.Id, filename = Model.UpgradeToVehicle.VehicleImage.Title + Model.UpgradeToVehicle.VehicleImage.FileExtension, width = 300})" alt="@Model.UpgradeToVehicle.Title" />
            }

            if (Model.UpgradeToVehicle.FileUploadId2.HasValue) {
                <img src="@Url.Action("Index", "Uploads", new { id = Model.UpgradeToVehicle.VehicleImage2.Id, filename = Model.UpgradeToVehicle.VehicleImage2.Title + Model.UpgradeToVehicle.VehicleImage2.FileExtension, width = 300})" alt="@Model.UpgradeToVehicle.Title Interior" />
            }

        } else {
            <h2>@Model.Vehicle.Title</h2>
            <p>@Model.Vehicle.VehicleGroup.TitleDescription</p>
            if (Model.Vehicle.FileUploadId.HasValue) {
                <img src="@Url.Action("Index", "Uploads", new { id = Model.Vehicle.VehicleImage.Id, filename = Model.Vehicle.VehicleImage.Title + Model.Vehicle.VehicleImage.FileExtension, width = 300})" alt="@Model.Vehicle.Title" />
            }

            if (Model.Vehicle.FileUploadId2.HasValue) {
                <img src="@Url.Action("Index", "Uploads", new { id = Model.Vehicle.VehicleImage2.Id, filename = Model.Vehicle.VehicleImage2.Title + Model.Vehicle.VehicleImage2.FileExtension, width = 300})" alt="@Model.Vehicle.Title Interior" />
            }
        }





        <h2 style="color: #19963C; border-bottom: 1px solid #999; margin: 0; padding: 5px 0 4px 0;">Important Information</h2>
        <p>Drivers must be 23 years or older, and must have a driver's license valid for at least 3 years.</p>

        <table style="width: 100%; font-size: 12px; margin-bottom: 10px;" cellpadding="0" cellspacing="0">
            <tbody>
                <tr>
                    <td style="width: 50%;">
                        <strong>Rental Price Includes:</strong><br />
                        Insurance against damage or theft<br />
                        Airport Surcharge<br />
                        Tourism Levy / VAT<br />
                        <br /><br />
                    </td>
                    <td style="text-align: right; width: 50%;">
                        <strong>Rental Price Excludes:</strong><br />
                        Security Deposit<br />
                        Fuel top up on drop off<br />
                        Excess km<br />
                        Excess liability<br />
                        Toll fees
                    </td>
                </tr>
            </tbody>
        </table>
        <p>
            For a full list of our <a href="##siteDomain##/TermsAndConditions">Terms and Conditions</a> please visit the Woodford website.
        </p>
    </div>
</div>

<div class="row">
    <hr />
</div>

<div class="row" style="padding-top: 10px;">
    <!-- TrustBox widget - 0 -->
    <div class="trustpilot-widget" data-locale="en-GB" data-template-id="53aa8912dec7e10d38f59f36" data-businessunit-id="54620ca500006400057b77fe" data-style-height="130px" data-style-width="100%" data-theme="light" data-stars="4,5">
        <a href="https://uk.trustpilot.com/review/www.woodford.co.za" target="_blank">Trustpilot</a>
    </div>
    <!-- End TrustBox widget -->
</div>

@section scripts {

<script type="text/javascript">
        $(document).ready(function () {
            $(".printquote").on("click", function (e) {
                var url = "@Url.Action("Print", new { id = Model.Reservation.Id })";
                var windowName = "";
                var win = window.open(url, windowName, 'width=700,height=800,scrollbars=yes');
                win.focus();
                e.preventDefault();
                return false;
            });
        });
</script>


    <script type="text/javascript">

        ga('require', 'ecommerce');

        ga('ecommerce:addTransaction', {
            'id': '@Model.Reservation.Id',
            'affiliation': 'Woodford Car Hire',
            'revenue': '@Model.Reservation.BookingPrice.ToString().Replace(",", ".")'
        });

        ga('ecommerce:addItem', {
            'id': '@Model.Reservation.RateId',
            'name': '@Model.Reservation.Vehicle.Title - @Model.Reservation.RateCodeTitle',
            'price': '@Model.Reservation.BookingPrice.ToString().Replace(",", ".")'
        });

        ga('ecommerce:send');

        //ga('ecommerce:clear');
</script>
    }